import{a as _e}from"./chunk-LVTVU3DI.js";import{a as Se}from"./chunk-K64XODE3.js";import{a as xe}from"./chunk-7GTF46RG.js";import{a as be}from"./chunk-GRCIMK6Y.js";import{a as p,b as j,c as N,d as ce,e as L,f as H,g as k,h as R,i as me,j as ue}from"./chunk-FRTIDM5M.js";import{a as fe}from"./chunk-U7ORV3TA.js";import{a as he,b as ve,c as ge}from"./chunk-CREHCLFR.js";import{b as ne,d as re,f as oe,n as ae,o as le}from"./chunk-Y4YVEZW5.js";import{a as pe}from"./chunk-GPUHOX6N.js";import{a as se}from"./chunk-4PDPG5IP.js";import{a as de}from"./chunk-YSOC5NDB.js";import{a as ie}from"./chunk-TZDLMB3W.js";import{c as q,d as G,e as Q,f as J,i as K,o as Z,q as ee,u as te}from"./chunk-4IG42SO7.js";import{$a as I,Ab as w,Ia as d,Ja as _,Sa as m,Va as S,Za as n,_a as i,da as X,db as A,hb as v,ia as E,ib as f,ja as O,ka as F,la as z,nb as a,pb as h,qb as b,ub as Y,vb as U,wb as $,yb as B,zb as x}from"./chunk-MXAX4ZQ5.js";function P(t,o){let e=p(t),s=p(o),r=e.getTime()-s.getTime();return r<0?-1:r>0?1:r}function we(t,o){let e=p(t),s=p(o),r=e.getFullYear()-s.getFullYear(),l=e.getMonth()-s.getMonth();return r*12+l}function ye(t){return t?Math[t]:Math.trunc}function Ce(t,o){return p(t).getTime()-p(o).getTime()}function De(t){let o=p(t);return o.setHours(23,59,59,999),o}function Me(t){let o=p(t),e=o.getMonth();return o.setFullYear(o.getFullYear(),e+1,0),o.setHours(23,59,59,999),o}function Ee(t){let o=p(t);return+De(o)==+Me(o)}function Oe(t,o){let e=p(t),s=p(o),r=P(e,s),l=Math.abs(we(e,s)),c;if(l<1)c=0;else{e.getMonth()===1&&e.getDate()>27&&e.setDate(30),e.setMonth(e.getMonth()-r*l);let u=P(e,s)===-r;Ee(p(t))&&l===1&&P(t,s)===1&&(u=!1),c=r*(l-Number(u))}return c===0?0:c}function Ie(t,o,e){let s=Ce(t,o)/1e3;return ye(e?.roundingMethod)(s)}function Te(t,o,e){let s=ce(),r=e?.locale??s.locale??ue,l=2520,c=P(t,o);if(isNaN(c))throw new RangeError("Invalid time value");let u=Object.assign({},e,{addSuffix:e?.addSuffix,comparison:c}),D,M;c>0?(D=p(o),M=p(t)):(D=p(t),M=p(o));let y=Ie(M,D),V=(L(M)-L(D))/1e3,g=Math.round((y-V)/60),T;if(g<2)return e?.includeSeconds?y<5?r.formatDistance("lessThanXSeconds",5,u):y<10?r.formatDistance("lessThanXSeconds",10,u):y<20?r.formatDistance("lessThanXSeconds",20,u):y<40?r.formatDistance("halfAMinute",0,u):y<60?r.formatDistance("lessThanXMinutes",1,u):r.formatDistance("xMinutes",1,u):g===0?r.formatDistance("lessThanXMinutes",1,u):r.formatDistance("xMinutes",g,u);if(g<45)return r.formatDistance("xMinutes",g,u);if(g<90)return r.formatDistance("aboutXHours",1,u);if(g<N){let C=Math.round(g/60);return r.formatDistance("aboutXHours",C,u)}else{if(g<l)return r.formatDistance("xDays",1,u);if(g<j){let C=Math.round(g/N);return r.formatDistance("xDays",C,u)}else if(g<j*2)return T=Math.round(g/j),r.formatDistance("aboutXMonths",T,u)}if(T=Oe(M,D),T<12){let C=Math.round(g/j);return r.formatDistance("xMonths",C,u)}else{let C=T%12,W=Math.floor(T/12);return C<3?r.formatDistance("aboutXYears",W,u):C<9?r.formatDistance("overXYears",W,u):r.formatDistance("almostXYears",W+1,u)}}var He={lessThanXSeconds:{one:"menos de un segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"medio minuto",lessThanXMinutes:{one:"menos de un minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"alrededor de 1 hora",other:"alrededor de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 d\xEDa",other:"{{count}} d\xEDas"},aboutXWeeks:{one:"alrededor de 1 semana",other:"alrededor de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"alrededor de 1 mes",other:"alrededor de {{count}} meses"},xMonths:{one:"1 mes",other:"{{count}} meses"},aboutXYears:{one:"alrededor de 1 a\xF1o",other:"alrededor de {{count}} a\xF1os"},xYears:{one:"1 a\xF1o",other:"{{count}} a\xF1os"},overXYears:{one:"m\xE1s de 1 a\xF1o",other:"m\xE1s de {{count}} a\xF1os"},almostXYears:{one:"casi 1 a\xF1o",other:"casi {{count}} a\xF1os"}},Fe=(t,o,e)=>{let s,r=He[t];return typeof r=="string"?s=r:o===1?s=r.one:s=r.other.replace("{{count}}",o.toString()),e?.addSuffix?e.comparison&&e.comparison>0?"en "+s:"hace "+s:s};var Ve={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/y"},We={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Ue={full:"{{date}} 'a las' {{time}}",long:"{{date}} 'a las' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Ae={date:H({formats:Ve,defaultWidth:"full"}),time:H({formats:We,defaultWidth:"full"}),dateTime:H({formats:Ue,defaultWidth:"full"})};var Ne={lastWeek:"'el' eeee 'pasado a la' p",yesterday:"'ayer a la' p",today:"'hoy a la' p",tomorrow:"'ma\xF1ana a la' p",nextWeek:"eeee 'a la' p",other:"P"},Le={lastWeek:"'el' eeee 'pasado a las' p",yesterday:"'ayer a las' p",today:"'hoy a las' p",tomorrow:"'ma\xF1ana a las' p",nextWeek:"eeee 'a las' p",other:"P"},ke=(t,o,e,s)=>o.getHours()!==1?Le[t]:Ne[t];var Xe={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","despu\xE9s de cristo"]},Ye={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1\xBA trimestre","2\xBA trimestre","3\xBA trimestre","4\xBA trimestre"]},$e={narrow:["e","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],wide:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},Be={narrow:["d","l","m","m","j","v","s"],short:["do","lu","ma","mi","ju","vi","s\xE1"],abbreviated:["dom","lun","mar","mi\xE9","jue","vie","s\xE1b"],wide:["domingo","lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado"]},qe={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"ma\xF1ana",afternoon:"tarde",evening:"tarde",night:"noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"ma\xF1ana",afternoon:"tarde",evening:"tarde",night:"noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"ma\xF1ana",afternoon:"tarde",evening:"tarde",night:"noche"}},Ge={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"de la ma\xF1ana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"de la ma\xF1ana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"de la ma\xF1ana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"}},Qe=(t,o)=>Number(t)+"\xBA",Re={ordinalNumber:Qe,era:k({values:Xe,defaultWidth:"wide"}),quarter:k({values:Ye,defaultWidth:"wide",argumentCallback:t=>Number(t)-1}),month:k({values:$e,defaultWidth:"wide"}),day:k({values:Be,defaultWidth:"wide"}),dayPeriod:k({values:qe,defaultWidth:"wide",formattingValues:Ge,defaultFormattingWidth:"wide"})};var Je=/^(\d+)(º)?/i,Ke=/\d+/i,Ze={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|a\.?\s?e\.?\s?c\.?|d\.?\s?c\.?|e\.?\s?c\.?)/i,wide:/^(antes de cristo|antes de la era com[uú]n|despu[eé]s de cristo|era com[uú]n)/i},et={any:[/^ac/i,/^dc/i],wide:[/^(antes de cristo|antes de la era com[uú]n)/i,/^(despu[eé]s de cristo|era com[uú]n)/i]},tt={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](º)? trimestre/i},it={any:[/1/i,/2/i,/3/i,/4/i]},nt={narrow:/^[efmajsond]/i,abbreviated:/^(ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)/i,wide:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i},rt={narrow:[/^e/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^en/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i]},ot={narrow:/^[dlmjvs]/i,short:/^(do|lu|ma|mi|ju|vi|s[áa])/i,abbreviated:/^(dom|lun|mar|mi[ée]|jue|vie|s[áa]b)/i,wide:/^(domingo|lunes|martes|mi[ée]rcoles|jueves|viernes|s[áa]bado)/i},at={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^do/i,/^lu/i,/^ma/i,/^mi/i,/^ju/i,/^vi/i,/^sa/i]},lt={narrow:/^(a|p|mn|md|(de la|a las) (mañana|tarde|noche))/i,any:/^([ap]\.?\s?m\.?|medianoche|mediodia|(de la|a las) (mañana|tarde|noche))/i},st={any:{am:/^a/i,pm:/^p/i,midnight:/^mn/i,noon:/^md/i,morning:/mañana/i,afternoon:/tarde/i,evening:/tarde/i,night:/noche/i}},Pe={ordinalNumber:me({matchPattern:Je,parsePattern:Ke,valueCallback:function(t){return parseInt(t,10)}}),era:R({matchPatterns:Ze,defaultMatchWidth:"wide",parsePatterns:et,defaultParseWidth:"any"}),quarter:R({matchPatterns:tt,defaultMatchWidth:"wide",parsePatterns:it,defaultParseWidth:"any",valueCallback:t=>t+1}),month:R({matchPatterns:nt,defaultMatchWidth:"wide",parsePatterns:rt,defaultParseWidth:"any"}),day:R({matchPatterns:ot,defaultMatchWidth:"wide",parsePatterns:at,defaultParseWidth:"any"}),dayPeriod:R({matchPatterns:lt,defaultMatchWidth:"any",parsePatterns:st,defaultParseWidth:"any"})};var ze={code:"es",formatDistance:Fe,formatLong:Ae,formatRelative:ke,localize:Re,match:Pe,options:{weekStartsOn:1,firstWeekContainsDate:1}};function dt(t,o){if(t&1&&(n(0,"ng-option",37),a(1),i()),t&2){let e=o.$implicit;m("value",e.id),d(),b(" ",e.apellido," ",e.nombre," ")}}function ct(t,o){t&1&&(n(0,"p",38),a(1," No se encontraron usuario "),i())}function mt(t,o){if(t&1){let e=A();n(0,"div",39)(1,"p"),a(2),i(),n(3,"button",40),v("click",function(){let l=E(e).$implicit,c=f();return O(c.eliminarTecnico(l.id))}),F(),n(4,"svg",3),I(5,"path",4),i()()()}if(t&2){let e=o.$implicit;d(2),b(" ",e.apellido," ",e.nombre," ")}}var je=t=>({"bg-primaryColor text-white":t});function ut(t,o){if(t&1){let e=A();n(0,"div",41)(1,"button",42),v("click",function(){E(e);let r=f();return O(r.cambiarSeccion("Detalles"))}),a(2," Detalles "),i(),n(3,"button",43),v("click",function(){E(e);let r=f();return O(r.cambiarSeccion("Historial"))}),a(4," Historial "),i()()}if(t&2){let e=f();d(),m("ngClass",U(2,je,e.showSeccion==="Detalles")),d(2),m("ngClass",U(4,je,e.showSeccion==="Historial"))}}function pt(t,o){if(t&1&&(n(0,"span",53),a(1),i()),t&2){let e=o.$implicit;d(),b(" ",e==null?null:e.apellido," ",e==null?null:e.nombre," ")}}function ft(t,o){if(t&1&&(n(0,"p",47)(1,"span",21),a(2," Tecnicos asignados: "),i(),S(3,pt,2,2,"span",52),i()),t&2){let e=f(2);d(3),m("ngForOf",e.tecnicosAsignados)}}function ht(t,o){if(t&1&&(n(0,"div",54)(1,"p",47)(2,"span",21),a(3," Fecha en proceso: "),i(),n(4,"span"),a(5),x(6,"fechaHora"),i()()()),t&2){let e=f(2);d(5),h(" ",w(6,1,e.orden==null?null:e.orden.fechaEnProceso)," ")}}var vt=(t,o)=>({"bg-red-100":t,"bg-green-100":o});function gt(t,o){if(t&1&&(n(0,"div")(1,"p",55)(2,"span",21),a(3," Fecha de cierre: "),i(),n(4,"span"),a(5),x(6,"fechaHora"),i()()()),t&2){let e=f(2);d(),m("ngClass",$(4,vt,(e.orden==null?null:e.orden.estadoOrden)==="Rechazada",(e.orden==null?null:e.orden.estadoOrden)==="Completada")),d(4),h(" ",w(6,2,e.orden==null?null:e.orden.fechaCierre)," ")}}function St(t,o){if(t&1&&(n(0,"div",47)(1,"p",56)(2,"span",21),a(3," Demora de solucion: "),i(),n(4,"span",57),a(5),i()()()),t&2){let e=f(2);d(5),h(" ",e.demoraSolucion," ")}}function _t(t,o){if(t&1&&(n(0,"div",58)(1,"p",47)(2,"span",21),a(3," Motivo de rechazo: "),i(),n(4,"span"),a(5),i()()()),t&2){let e=f(2);d(5),h(" ",e.orden==null?null:e.orden.motivoRechazo," ")}}function bt(t,o){if(t&1&&(n(0,"div")(1,"div",44),S(2,ft,4,1,"p",45),i(),n(3,"div",46)(4,"p",47)(5,"span",21),a(6," Nro de solicitud: "),i(),n(7,"span"),a(8),i()()(),n(9,"div")(10,"p",47)(11,"span",21),a(12," Fecha de solicitud: "),i(),n(13,"span"),a(14),x(15,"fechaHora"),i()()(),S(16,ht,7,3,"div",48)(17,gt,7,7,"div",35)(18,St,6,1,"div",45),n(19,"div",46)(20,"p",47)(21,"span",21),a(22," Solicitante: "),i(),n(23,"span"),a(24),n(25,"span",49),a(26),i()()(),n(27,"p",50)(28,"span",21),a(29," Tel. Contacto: "),i(),n(30,"span"),a(31),i()()(),n(32,"div",46)(33,"p",47)(34,"span",21),a(35," Dependencia: "),i(),n(36,"span"),a(37),i()()(),n(38,"div",46)(39,"p",47)(40,"span",21),a(41," Tipo de solicitud: "),i(),n(42,"span"),a(43),i()()(),n(44,"div",46)(45,"p",47)(46,"span",21),a(47," Detalles: "),i(),n(48,"span"),a(49),i()()(),S(50,_t,6,1,"div",51),i()),t&2){let e=f();d(2),m("ngIf",(e.orden==null?null:e.orden.estadoOrden)==="En proceso"),d(6),h(" ",e.orden==null?null:e.orden.id," "),d(6),h(" ",w(15,14,e.orden==null?null:e.orden.createdAt)," "),d(2),m("ngIf",(e.orden==null?null:e.orden.estadoOrden)!=="Pendiente"),d(),m("ngIf",(e.orden==null?null:e.orden.estadoOrden)!=="Pendiente"&&(e.orden==null?null:e.orden.estadoOrden)!=="En proceso"),d(),m("ngIf",(e.orden==null?null:e.orden.estadoOrden)==="Completada"||(e.orden==null?null:e.orden.estadoOrden)==="Rechazada"),d(6),b(" ",e.orden==null?null:e.orden.usuario.apellido," ",e.orden==null?null:e.orden.usuario.nombre," "),d(2),h(" (Tel. ",e.orden==null?null:e.orden.usuario.telefono,") "),d(5),h(" ",e.orden==null?null:e.orden.telefonoContacto," "),d(6),h(" ",e.orden==null?null:e.orden.dependencia.nombre," "),d(6),h(" ",e.orden==null?null:e.orden.tipoOrdenServicio.descripcion," "),d(6),h(" ",e.orden==null?null:e.orden.observacionSolicitud," "),d(),m("ngIf",(e.orden==null?null:e.orden.estadoOrden)==="Rechazada")}}function xt(t,o){if(t&1){let e=A();n(0,"button",62),v("click",function(){E(e);let r=f(2);return O(r.abrirRechazar())}),a(1," Rechazar "),i()}}function wt(t,o){if(t&1){let e=A();n(0,"button",63),v("click",function(){E(e);let r=f(2);return O(r.abrirAsignacion())}),a(1," Continuar "),i()}}function yt(t,o){if(t&1){let e=A();n(0,"button",63),v("click",function(){E(e);let r=f(2);return O(r.completarSolicitud())}),a(1," Completar "),i()}}function Ct(t,o){if(t&1&&(n(0,"div",59),S(1,xt,2,0,"button",60)(2,wt,2,0,"button",61)(3,yt,2,0,"button",61),i()),t&2){let e=f();d(),m("ngIf",e.showSeccion==="Detalles"&&((e.orden==null?null:e.orden.estadoOrden)==="Pendiente"||(e.orden==null?null:e.orden.estadoOrden)==="En proceso")),d(),m("ngIf",(e.orden==null?null:e.orden.estadoOrden)==="Pendiente"&&e.showSeccion==="Detalles"),d(),m("ngIf",(e.orden==null?null:e.orden.estadoOrden)==="En proceso"&&e.showSeccion==="Detalles")}}function Dt(t,o){if(t&1&&(n(0,"div",71)(1,"div",72)(2,"p",21),a(3," Solicitud generada "),i(),n(4,"p"),a(5),x(6,"fechaHora"),i()(),n(7,"p",73)(8,"span",21),a(9," Usuario: "),i(),a(10),i()()),t&2){let e=f().$implicit;d(5),h(" ",w(6,3,e.createdAt)," "),d(5),b(" ",e.creatorUser.apellido," ",e.creatorUser.nombre," ")}}function Mt(t,o){if(t&1&&(n(0,"span",77),a(1),i()),t&2){let e=o.$implicit;d(),b(" ",e.tecnico.apellido," ",e.tecnico.nombre," ")}}function Et(t,o){if(t&1&&(n(0,"div",74)(1,"div",72)(2,"p",21),a(3," En proceso "),i(),n(4,"p"),a(5),x(6,"fechaHora"),i()(),n(7,"p",73)(8,"span",21),a(9," Usuario: "),i(),a(10),i(),n(11,"p",75),S(12,Mt,2,2,"span",76),i()()),t&2){let e=f().$implicit;d(5),h(" ",w(6,4,e.createdAt)," "),d(5),b(" ",e.creatorUser.apellido," ",e.creatorUser.nombre," "),d(2),m("ngForOf",e.OrdenesServicioHistorialToTecnicos)}}function Ot(t,o){if(t&1&&(n(0,"div",78)(1,"div",72)(2,"p",21),a(3," Solicitud rechazada "),i(),n(4,"p"),a(5),x(6,"fechaHora"),i()(),n(7,"p",73)(8,"span",21),a(9," Usuario: "),i(),a(10),i(),n(11,"p",79)(12,"span",21),a(13," Motivo: "),i(),a(14),i()()),t&2){let e=f().$implicit;d(5),h(" ",w(6,4,e.createdAt)," "),d(5),b(" ",e.creatorUser.apellido," ",e.creatorUser.nombre," "),d(4),h(" ",e.motivoRechazo," ")}}function It(t,o){if(t&1&&(n(0,"div",71)(1,"div",72)(2,"p",21),a(3," Solicitud reactivada "),i(),n(4,"p"),a(5),x(6,"fechaHora"),i()(),n(7,"p",73)(8,"span",21),a(9," Usuario: "),i(),a(10),i()()),t&2){let e=f().$implicit;d(5),h(" ",w(6,3,e.createdAt)," "),d(5),b(" ",e.creatorUser.apellido," ",e.creatorUser.nombre," ")}}function Tt(t,o){if(t&1&&(n(0,"div",80)(1,"div",72)(2,"p",21),a(3," Solicitud completada "),i(),n(4,"p"),a(5),x(6,"fechaHora"),i()(),n(7,"p",73)(8,"span",21),a(9," Usuario: "),i(),a(10),i()()),t&2){let e=f().$implicit;d(5),h(" ",w(6,3,e.createdAt)," "),d(5),b(" ",e.creatorUser.apellido," ",e.creatorUser.nombre," ")}}function Ft(t,o){if(t&1&&(n(0,"div",66),S(1,Dt,11,5,"div",67)(2,Et,13,6,"div",68)(3,Ot,15,6,"div",69)(4,It,11,5,"div",67)(5,Tt,11,5,"div",70),i()),t&2){let e=o.$implicit;d(),m("ngIf",e.tipo==="Generada"),d(),m("ngIf",e.tipo==="En proceso"),d(),m("ngIf",e.tipo==="Rechazada"),d(),m("ngIf",e.tipo==="Reactivada"),d(),m("ngIf",e.tipo==="Completada")}}function At(t,o){if(t&1&&(n(0,"div")(1,"div",64),S(2,Ft,6,5,"div",65),i()()),t&2){let e=f();d(2),m("ngForOf",e.historialOrden)}}var kt=(t,o,e,s)=>({"bg-yellow-500":t,"bg-red-500":o,"bg-green-700":e,"bg-blue-700":s}),Gi=(()=>{let o=class o{constructor(s,r,l,c,u,D,M,y,V,g){this.dataService=s,this.usuariosService=r,this.authService=l,this.ordenesServicio=c,this.activatedRoute=u,this.alertService=D,this.ordenesServicioHistorialService=M,this.ordenesServicioToTecnicosService=y,this.router=V,this.location=g,this.demoraSolucion="",this.showSeccion="Detalles",this.showModalAsignacion=!1,this.tecnicoSeleccionado="",this.tecnicosAsignados=[],this.tecnicosParaAsignar=[],this.showRechazar=!1,this.motivoRechazo="",this.historialOrden=[],this.idSolicitud="",this.orden=null,this.tecnicos=[]}ngOnInit(){this.dataService.ubicacionActual="Dashboard - Detalles de solicitud",this.alertService.loading(),this.activatedRoute.params.subscribe(({id:s})=>{this.idSolicitud=s,this.obtenerSolicitud()})}regresarRutaAnterior(){this.location.back()}calculoDemoraSolucion(){let s=new Date(this.orden.fechaCierre),r=new Date(this.orden.createdAt);this.demoraSolucion=Te(s,r,{locale:ze}),console.log(this.demoraSolucion)}obtenerSolicitud(){this.alertService.loading(),this.ordenesServicio.getOrden(this.idSolicitud).subscribe({next:({orden:s})=>{this.orden=s,this.historialOrden=this.orden.ordenesServicioHistorial,this.calculoDemoraSolucion(),this.tecnicosAsignados=[],s.ordenesServicioTecnico.map(r=>{r.activo&&this.tecnicosAsignados.push(r?.tecnico)}),console.log(this.tecnicosAsignados),this.alertService.close()},error:({error:s})=>this.alertService.errorApi(s.message)})}abrirRechazar(){this.motivoRechazo="",this.showRechazar=!0}rechazarSolicitud(){if(!this.motivoRechazo.trim()){this.alertService.info("El motivo de rechazo no puede estar vac\xEDo");return}this.alertService.question({msg:"\xBFQuieres rechazar la solicitud?",buttonText:"Aceptar"}).then(({isConfirmed:s})=>{if(s){this.alertService.loading();let r={fechaCierre:new Date().toISOString(),estadoOrden:"Rechazada",motivoRechazo:this.motivoRechazo,activo:!1};this.ordenesServicio.actualizarOrden(this.idSolicitud,r).subscribe({next:()=>{let l={tipo:"Rechazada",motivoRechazo:this.motivoRechazo,ordenServicioId:this.orden.id,creatorUserId:this.authService.usuario.userId};this.ordenesServicioHistorialService.nuevaRelacion(l).subscribe({next:()=>{this.alertService.close(),this.regresarRutaAnterior()},error:({error:c})=>this.alertService.errorApi(c.message)})},error:({error:l})=>this.alertService.errorApi(l.message)})}})}reactivarSolicitud(){this.alertService.question({msg:"\xBFQuieres reactivar la solicitud?",buttonText:"Aceptar"}).then(({isConfirmed:s})=>{if(s){this.alertService.loading();let r={tipo:"Reactivada",motivoRechazo:"",ordenServicioId:this.orden.id,creatorUserId:this.authService.usuario.userId,activo:!0};this.ordenesServicioHistorialService.nuevaRelacion(r).subscribe({next:()=>{let l={fechaCierre:new Date().toISOString(),estadoOrden:"Pendiente",motivoRechazo:"",activo:!0};this.ordenesServicio.actualizarOrden(this.idSolicitud,l).subscribe({next:({orden:c})=>{this.orden=c,this.alertService.close()},error:({error:c})=>this.alertService.errorApi(c.message)})},error:({error:l})=>this.alertService.errorApi(l.message)})}})}abrirAsignacion(){this.tecnicoSeleccionado="",this.tecnicosParaAsignar=[],this.alertService.loading(),this.usuariosService.listarUsuarios(1,"apellido","true","true","").subscribe({next:({usuarios:s})=>{this.tecnicos=s,this.showModalAsignacion=!0,this.alertService.close()},error:({error:s})=>this.alertService.errorApi(s.message)})}agregarTecnico(){if(!this.tecnicoSeleccionado){this.alertService.info("Debes seleccionar un t\xE9cnico");return}let s=this.tecnicos.find(r=>r.id===this.tecnicoSeleccionado);this.tecnicosParaAsignar.push(s),this.tecnicos=this.tecnicos.filter(r=>r.id!==this.tecnicoSeleccionado),this.tecnicoSeleccionado=""}eliminarTecnico(s){let r=this.tecnicosParaAsignar.find(l=>l.id===s);this.tecnicosParaAsignar=this.tecnicosParaAsignar.filter(l=>l.id!==s),this.tecnicos.push(r)}asignarTecnicos(){if(this.tecnicosParaAsignar.length===0){this.alertService.info("Debes seleccionar al menos un t\xE9cnico");return}let s={tecnicos:[],fechaEnProceso:new Date().toISOString(),ordenServicioId:this.idSolicitud,creatorUserId:this.authService.usuario.userId};this.tecnicosParaAsignar.forEach(r=>s.tecnicos.push({id:r.id})),this.alertService.question({msg:"\xBFQuieres asignar el/los t\xE9cnicos a la solicitud?",buttonText:"Aceptar"}).then(({isConfirmed:r})=>{r&&(this.alertService.loading(),this.ordenesServicioToTecnicosService.nuevaOrdenTecnico(s).subscribe({next:()=>{let l={tipo:"En proceso",tecnicos:s.tecnicos,ordenServicioId:this.orden.id,creatorUserId:this.authService.usuario.userId};this.ordenesServicioHistorialService.nuevaRelacion(l).subscribe({next:()=>{this.alertService.close(),this.regresarRutaAnterior()},error:({error:c})=>this.alertService.errorApi(c.message)})},error:({error:l})=>this.alertService.errorApi(l.message)}))})}completarSolicitud(){this.alertService.question({msg:"\xBFQuieres completar la solicitud?",buttonText:"Aceptar"}).then(({isConfirmed:s})=>{if(s){this.alertService.loading();let r={fechaCierre:new Date().toISOString(),estadoOrden:"Completada",activo:!1};this.ordenesServicio.actualizarOrden(this.idSolicitud,r).subscribe({next:()=>{let l={tipo:"Completada",ordenServicioId:this.orden.id,creatorUserId:this.authService.usuario.userId};this.ordenesServicioHistorialService.nuevaRelacion(l).subscribe({next:()=>{this.alertService.close(),this.regresarRutaAnterior()},error:({error:c})=>this.alertService.errorApi(c.message)})},error:({error:l})=>this.alertService.errorApi(l.message)})}})}cambiarSeccion(s){this.showSeccion=s}};o.\u0275fac=function(r){return new(r||o)(_(de),_(pe),_(ie),_(be),_(Z),_(se),_(xe),_(_e),_(ee),_(q))},o.\u0275cmp=X({type:o,selectors:[["app-detalles-orden-servicio-final"]],standalone:!0,features:[Y],decls:65,vars:18,consts:[[3,"showModal"],[1,"p-2","bg-gray-900","text-white","flex","items-center","justify-between"],[1,"hover:text-secondaryColor",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18 18 6M6 6l12 12"],[1,"bg-white","p-2","text-sm"],[1,"flex","items-center"],[1,"w-full","text-sm","p-2","rounded",3,"ngModel","ngModelChange"],["value",""],["class","bg-white",3,"value",4,"ngFor","ngForOf"],["title","Agregar tecnico",1,"boton-crear","rounded",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor","title","Agregar tecnico",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","d","M12 4.5v15m7.5-7.5h-15"],[1,"px-2"],[1,"font-semibold","p-2","bg-gray-100","border","border-gray-300"],["class","text-gray-500 italic text-sm mt-2",4,"ngIf"],["class","p-2 flex mt-1 items-center justify-between border-b border-gray-300",4,"ngFor","ngForOf"],[1,"flex","px-2","pb-2","items-center","mt-3"],[1,"w-1/2","boton-eliminar",3,"click"],[1,"w-1/2","ml-2","boton-crear",3,"click"],[1,"p-2","bg-white","text-sm"],[1,"font-semibold"],[1,"text-red-700"],["type","text","placeholder","Ej. No tenemos insumos",1,"input-generico","w-full","mt-2",3,"ngModel","keyup.enter","ngModelChange"],[1,"flex","px-2","pb-2","mt-2","items-center","w-full"],[1,"border","border-gray-400","w-11/12","md:w-2/3","mx-auto","mt-6","mb-4"],[1,"bg-gray-900","w-full","text-white","p-3","flex","items-center"],[1,"flex","items-center","justify-between","w-full"],["title","Regresar",1,"hover:text-secondaryColor",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"],[1,"ml-2","text-xl"],[1,"px-2","py-1","mt-1","rounded","w-max","text-xs","ml-2",3,"ngClass"],[1,"mr-2"],[1,"p-2","text-sm"],["class","border border-gray-400 rounded",4,"ngIf"],[4,"ngIf"],["class","flex items-center mt-2",4,"ngIf"],[1,"bg-white",3,"value"],[1,"text-gray-500","italic","text-sm","mt-2"],[1,"p-2","flex","mt-1","items-center","justify-between","border-b","border-gray-300"],["title","Eliminar tecnico",1,"text-red-700",3,"click"],[1,"border","border-gray-400","rounded"],[1,"w-1/2","p-2","font-semibold",3,"ngClass","click"],[1,"w-1/2","p-2","font-semibold","border-l","border-gray-400",3,"ngClass","click"],[1,"mt-4"],["class","p-2",4,"ngIf"],[1,"border-y"],[1,"p-2"],["class","border-t",4,"ngIf"],[1,"text-xs"],[1,"p-2","border-t"],["class","bg-red-100 border-y",4,"ngIf"],["class","text-xs py-1 px-2 bg-blue-100 border border-blue-300 ml-2 rounded",4,"ngFor","ngForOf"],[1,"text-xs","py-1","px-2","bg-blue-100","border","border-blue-300","ml-2","rounded"],[1,"border-t"],[1,"p-2","bg-gray-200",3,"ngClass"],[1,"py-1"],[1,"bg-gray-100","px-2","py-1","rounded","border","border-gray-400","ml-1"],[1,"bg-red-100","border-y"],[1,"flex","items-center","mt-2"],["class","boton-eliminar w-1/2",3,"click",4,"ngIf"],["class","boton-crear w-1/2 ml-2",3,"click",4,"ngIf"],[1,"boton-eliminar","w-1/2",3,"click"],[1,"boton-crear","w-1/2","ml-2",3,"click"],[1,"p-2","max-h-72","overflow-y-auto"],["class","border mb-4 rounded text-sm border-gray-400",4,"ngFor","ngForOf"],[1,"border","mb-4","rounded","text-sm","border-gray-400"],["class","border-l-8 border-yellow-400 rounded-l p-2",4,"ngIf"],["class","border-l-8 border-blue-400 rounded-l p-2",4,"ngIf"],["class","border-l-8 border-red-400 rounded-l p-2",4,"ngIf"],["class","border-l-8 border-green-400 rounded-l p-2",4,"ngIf"],[1,"border-l-8","border-yellow-400","rounded-l","p-2"],[1,"flex","items-center","justify-between"],[1,"mt-2"],[1,"border-l-8","border-blue-400","rounded-l","p-2"],[1,"mt-4","mb-2"],["class","bg-blue-100 rounded mr-2 border text-xs border-blue-300 p-2",4,"ngFor","ngForOf"],[1,"bg-blue-100","rounded","mr-2","border","text-xs","border-blue-300","p-2"],[1,"border-l-8","border-red-400","rounded-l","p-2"],[1,"mt-2","bg-red-100","p-2"],[1,"border-l-8","border-green-400","rounded-l","p-2"]],template:function(r,l){r&1&&(n(0,"app-modal",0)(1,"div")(2,"div",1)(3,"h1"),a(4," Asignacion de tecnico "),i(),n(5,"button",2),v("click",function(){return l.showModalAsignacion=!1}),F(),n(6,"svg",3),I(7,"path",4),i()()(),z(),n(8,"div",5)(9,"div",6)(10,"ng-select",7),v("ngModelChange",function(u){return l.tecnicoSeleccionado=u}),n(11,"ng-option",8),a(12," Seleccionar tecnico "),i(),S(13,dt,2,3,"ng-option",9),i(),n(14,"button",10),v("click",function(){return l.agregarTecnico()}),F(),n(15,"svg",11),I(16,"path",12),i()()(),z(),n(17,"div",13)(18,"p",14),a(19," Usuarios asignados "),i(),S(20,ct,2,0,"p",15)(21,mt,6,2,"div",16),i()(),n(22,"div",17)(23,"button",18),v("click",function(){return l.showModalAsignacion=!l.showModalAsignacion}),a(24," Cancelar "),i(),n(25,"button",19),v("click",function(){return l.asignarTecnicos()}),a(26," Asignar "),i()()()(),n(27,"app-modal",0)(28,"div")(29,"div",1)(30,"h1"),a(31," Rechanzando solicitud "),i(),n(32,"button",2),v("click",function(){return l.showRechazar=!1}),F(),n(33,"svg",3),I(34,"path",4),i()()(),z(),n(35,"div",20)(36,"p",21)(37,"span",22),a(38," * "),i(),a(39," Motivo de rechazo "),i(),n(40,"input",23),v("keyup.enter",function(){return l.rechazarSolicitud()})("ngModelChange",function(u){return l.motivoRechazo=u}),i()(),n(41,"div",24)(42,"button",18),v("click",function(){return l.showRechazar=!1}),a(43," Cancelar "),i(),n(44,"button",19),v("click",function(){return l.rechazarSolicitud()}),a(45," Aceptar "),i()()()(),n(46,"div",25)(47,"div",26)(48,"div",27)(49,"div",6)(50,"button",28),v("click",function(){return l.regresarRutaAnterior()}),F(),n(51,"svg",3),I(52,"path",29),i()(),z(),n(53,"div")(54,"h1",30),a(55," Detalles de solicitud "),i(),n(56,"p",31),a(57),i()()(),I(58,"div",32),i()(),n(59,"div",33)(60,"div"),S(61,ut,5,6,"div",34)(62,bt,51,16,"div",35)(63,Ct,4,3,"div",36),i(),S(64,At,3,1,"div",35),i()()),r&2&&(m("showModal",l.showModalAsignacion),d(10),m("ngModel",l.tecnicoSeleccionado),d(3),m("ngForOf",l.tecnicos),d(7),m("ngIf",l.tecnicosParaAsignar.length===0),d(),m("ngForOf",l.tecnicosParaAsignar),d(6),m("showModal",l.showRechazar),d(13),m("ngModel",l.motivoRechazo),d(16),m("ngClass",B(13,kt,(l.orden==null?null:l.orden.estadoOrden)==="Pendiente",(l.orden==null?null:l.orden.estadoOrden)==="Rechazada",(l.orden==null?null:l.orden.estadoOrden)==="Completada",(l.orden==null?null:l.orden.estadoOrden)==="En proceso")),d(),h(" ",l.orden==null?null:l.orden.estadoOrden," "),d(4),m("ngIf",l.authService.usuario.role!=="USER_ROLE"),d(),m("ngIf",l.showSeccion==="Detalles"),d(),m("ngIf",l.authService.usuario.role!=="USER_ROLE"),d(),m("ngIf",l.showSeccion==="Historial"))},dependencies:[te,ae,ne,re,oe,ge,ve,he,le,fe,K,G,Q,J,Se],encapsulation:2});let t=o;return t})();export{Gi as default};
