import{j as k,q as I,v as b}from"./chunk-G53VBJ5X.js";import{E as h,T as f,X as g,aa as m,p,t as a}from"./chunk-MXAX4ZQ5.js";var s=class{constructor(o,v,e,t,r,u,c){this.userId=o,this.usuario=v,this.nombre=e,this.apellido=t,this.telefono=r,this.dependencias=u,this.role=c}};var l=b.base_url,D=(()=>{let o=class o{constructor(e,t){this.http=e,this.router=t}login(e){return this.http.post(`${l}/auth/login`,e).pipe(f(({token:t})=>{let r="bearer "+t;localStorage.setItem("token",r)}))}logout(){localStorage.removeItem("token"),this.router.navigateByUrl("login")}validarToken(){let e=localStorage.getItem("token");return this.http.get(`${l}/profile`,{headers:{Authorization:e}}).pipe(a(t=>{let{userId:r,usuario:u,apellido:c,nombre:S,role:j,telefono:L}=t.usuario,d=[];return t.usuario.dependencias.map(n=>{d.push({idDependencia:n.dependencia?.id,nombre:n?.dependencia?.nombre,idRelacion:n.id,soloLectura:n.soloLectura})}),this.usuario=new s(r,u,S,c,L,d,j),localStorage.setItem("token",t.token),!0}),h(t=>p(!1)))}validarAdmin(){let e=localStorage.getItem("token");return this.http.get(`${l}/profile`,{headers:{Authorization:e}}).pipe(a(t=>t.usuario.role==="ADMIN_ROLE"))}proteccionLogin(){let e=localStorage.getItem("token");return this.http.get(`${l}/auth`,{headers:{"x-token":e}}).pipe(a(()=>!1),h(t=>p(!0)))}};o.\u0275fac=function(t){return new(t||o)(m(k),m(I))},o.\u0275prov=g({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();export{D as a};
