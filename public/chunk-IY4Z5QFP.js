import{a as ie}from"./chunk-6WTSTGEY.js";import{a as ne}from"./chunk-YRO5L3ZL.js";import{a as te}from"./chunk-PQ5DNONA.js";import{c as ee}from"./chunk-N3QE4A3U.js";import{b as $,d as q,f as z,j as B,k as P,l as J,n as K}from"./chunk-VPZWFYDW.js";import{a as Z}from"./chunk-U2FQGFRY.js";import{a as X}from"./chunk-IZVGSZFI.js";import{a as W}from"./chunk-BPTFILPP.js";import{a as Y}from"./chunk-PSNAPTFY.js";import{a as Q}from"./chunk-YTKP2FMU.js";import{d as A,e as L,f as G,i as H}from"./chunk-GB7V6XFW.js";import{$a as f,A as F,Fb as R,G as M,Gb as V,Ia as l,Ib as j,Ja as v,K as N,Sa as c,Va as h,Za as i,_a as e,da as D,db as C,hb as m,ia as b,ib as S,ja as x,ka as U,la as T,nb as a,pb as g,qb as I,t as y,ub as k,vb as E}from"./chunk-75MKQ6H5.js";var ae=["buscadorUsuarios"];function se(r,d){r&1&&(i(0,"p",19)(1,"span",22),a(2," * "),e(),a(3," Usuario solicitante "),e())}function le(r,d){r&1&&(i(0,"span",28),U(),i(1,"svg",29),f(2,"path",30),e()())}function ce(r,d){if(r&1){let o=C();i(0,"div",38),m("click",function(){let t=b(o).$implicit,u=S(2);return x(u.seleccionarUsuario(t))}),f(1,"img",39),i(2,"div",40)(3,"p",19),a(4),e(),i(5,"p",41),a(6),e(),i(7,"p",41),a(8),e()()()}if(r&2){let o=d.$implicit;l(4),I(" ",o.apellido," ",o.nombre," "),l(2),g(" DNI ",o.dni," "),l(2),g(" ",o.UsuariosDependencias[0]?o.UsuariosDependencias[0].dependencia.nombre:"Sin dependencia"," ")}}function de(r,d){if(r&1){let o=C();i(0,"div",31)(1,"div",32)(2,"p",19),a(3," Listado de usuarios "),e(),i(4,"button",33),m("click",function(){b(o);let s=S();return x(s.usuarios=[])}),U(),i(5,"svg",34),f(6,"path",35),e()()(),T(),i(7,"div",36),h(8,ce,9,4,"div",37),e()()}if(r&2){let o=S();l(8),c("ngForOf",o.usuarios)}}function ue(r,d){if(r&1){let o=C();i(0,"div",42)(1,"div",43)(2,"div",44),f(3,"img",45),i(4,"div",40)(5,"p",19),a(6),e(),i(7,"p",46),a(8),e()()(),i(9,"button",47),m("click",function(){b(o);let s=S();return x(s.eliminarUsuario())}),U(),i(10,"svg",34),f(11,"path",35),e()()()()}if(r&2){let o=S();l(6),I(" ",o.usuarioSeleccionado.apellido," ",o.usuarioSeleccionado.nombre," "),l(2),g(" DNI ",o.usuarioSeleccionado.dni," ")}}function pe(r,d){if(r&1&&(i(0,"option",49),a(1),e()),r&2){let o=d.$implicit;c("value",o.idDependencia),l(),g(" ",o.nombre," ")}}function me(r,d){if(r&1){let o=C();i(0,"div",18)(1,"p",19)(2,"span",20),a(3," * "),e(),a(4," Dependencia "),e(),i(5,"select",48),m("ngModelChange",function(s){b(o);let t=S();return x(t.dependenciaSeleccionada=s)}),h(6,pe,2,2,"option",25),e()()}if(r&2){let o=S();l(5),c("ngModel",o.dependenciaSeleccionada)("disabled",o.dependenciasUsuario.length<=1),l(),c("ngForOf",o.dependenciasUsuario)}}function ve(r,d){if(r&1&&(i(0,"option",49),a(1),e()),r&2){let o=d.$implicit;c("value",o.id),l(),g(" ",o.descripcion," ")}}var O=r=>({hidden:r}),Se=r=>({"bg-fuchsia-300 text-gray-700":r}),Ne=(()=>{let d=class d{constructor(n,s,t,u,p,w,_){this.dataService=n,this.authService=s,this.alertService=t,this.ordenesServicio=u,this.ordenesServicioHistorial=p,this.usuariosService=w,this.tiposOrdenServicioService=_,this.dependenciaSeleccionada="",this.dependenciasUsuario=[],this.solicitudEnviada=!1,this.showUsuarios=!1,this.buscandoUsuarios=!1,this.usuarios=[],this.usuarioSeleccionado=null,this.filtroUsuarios={parametro:""},this.tiposOrdenServicio=[],this.paginaActual=1,this.cantidadItems=10,this.solicitudForm={usuarioId:"",tipoOrdenServicioId:"",telefonoContacto:"",creatorUserId:this.authService.usuario.userId,observacionSolicitud:""}}ngOnInit(){W.from(".gsap-contenido",{y:100,opacity:0,duration:.2}),this.dataService.ubicacionActual="Dashboard - Nueva solicitud",this.alertService.loading(),this.authService.usuario.role==="USER_ROLE"&&(this.solicitudForm.telefonoContacto=this.authService.usuario.telefono),this.authService.usuario.role==="USER_ROLE"?(this.dependenciasUsuario=[],this.authService.usuario.dependencias.map(n=>{n.soloLectura||this.dependenciasUsuario.push({idDependencia:n.idDependencia,idRelacion:n.idRelacion,nombre:n.nombre})}),this.dependenciasUsuario.length>0&&(this.dependenciaSeleccionada=this.dependenciasUsuario[0].idDependencia)):(this.dependenciaSeleccionada="",this.dependenciasUsuario=[]),this.tiposOrdenServicioService.listarTipos({activo:"true"}).subscribe({next:({tipos:n})=>{this.tiposOrdenServicio=n,this.alertService.close()},error:({error:n})=>this.alertService.errorApi(n.message)})}ngAfterViewInit(){F(this.buscadorUsuarios?.nativeElement,"keyup").pipe(y(n=>n.target.value),M(500),N()).subscribe(n=>{this.filtroUsuarios.parametro=n,this.buscandoUsuarios=!0,this.paginaActual=1,this.buscarUsuarios()})}buscarUsuarios(){if(this.filtroUsuarios.parametro.trim()===""){this.buscandoUsuarios=!1;return}this.usuarios=[],this.usuariosService.listarUsuarios(1,"apellido","","",this.filtroUsuarios.parametro).subscribe({next:({usuarios:n})=>{this.usuarios=n,this.buscandoUsuarios=!1,this.alertService.close()},error:({error:n})=>this.alertService.errorApi(n.message)})}seleccionarUsuario(n){this.filtroUsuarios.parametro="",this.usuarioSeleccionado=n,this.solicitudForm.telefonoContacto=n.telefono,this.dependenciasUsuario=[],n.UsuariosDependencias.map(s=>{s.soloLectura||this.dependenciasUsuario.push({idDependencia:s.dependencia.id,idRelacion:s.id,nombre:s.dependencia.nombre})}),this.dependenciasUsuario.length>0&&(this.dependenciaSeleccionada=this.dependenciasUsuario[0].idDependencia),this.usuarios=[]}eliminarUsuario(){this.solicitudForm.telefonoContacto="",this.usuarioSeleccionado=null}generarSolicitud(){let{tipoOrdenServicioId:n,telefonoContacto:s,observacionSolicitud:t,creatorUserId:u}=this.solicitudForm;if(!this.dependenciaSeleccionada){this.alertService.info("Debe seleccionar una dependencia");return}if(!this.usuarioSeleccionado&&this.authService.usuario.role!=="USER_ROLE"){this.alertService.info("Debe seleccionar un usuario");return}if(!s){this.alertService.info("Debe ingresar un telefono de contacto");return}if(!n){this.alertService.info("Debe seleccionar un tipo de orden de servicio");return}if(!t){this.alertService.info("Debe ingresar un detalle");return}this.alertService.question({msg:"Generando solicitud",buttonText:"Aceptar"}).then(({isConfirmed:p})=>{if(p){this.alertService.loading();let w={usuarioId:this.authService.usuario.role==="USER_ROLE"?this.authService.usuario.userId:this.usuarioSeleccionado.id,tipoOrdenServicioId:Number(n),telefonoContacto:s,dependenciaId:Number(this.dependenciaSeleccionada),creatorUserId:u,observacionSolicitud:t};this.ordenesServicio.nuevaOrden(w).subscribe({next:({orden:_})=>{let re={ordenServicioId:_.id,tipo:"Generada",creatorUserId:this.authService.usuario.userId};this.ordenesServicioHistorial.nuevaRelacion(re).subscribe({next:()=>{this.usuarioSeleccionado=null,this.solicitudEnviada=!0,this.solicitudForm={usuarioId:"",telefonoContacto:this.authService.usuario.telefono,tipoOrdenServicioId:"",creatorUserId:this.authService.usuario.userId,observacionSolicitud:""},this.alertService.close()},error:({error:oe})=>this.alertService.errorApi(oe.message)})},error:({error:_})=>this.alertService.errorApi(_.message)})}})}regresarFormulario(){this.solicitudEnviada=!1}};d.\u0275fac=function(s){return new(s||d)(v(Y),v(Q),v(X),v(te),v(ne),v(Z),v(ie))},d.\u0275cmp=D({type:d,selectors:[["app-nueva-orden-servicio-final"]],viewQuery:function(s,t){if(s&1&&V(ae,5),s&2){let u;R(u=j())&&(t.buscadorUsuarios=u.first)}},standalone:!0,features:[k],decls:46,vars:22,consts:[[1,"w-1/2","mx-auto","p-2","mt-10",3,"ngClass"],[1,"text-center","font-semibold","text-4xl"],[1,"text-gray-600","text-center","mt-2"],["src","assets/svg/solicitudCompletada.svg","alt","Solicitud completada",1,"w-1/2","mx-auto","mt-4"],[1,"flex","items-center","justify-center","mt-4"],[1,"p-2","bg-primaryColor","hover:opacity-90","mt-4","rounded","text-white","w-max",3,"click"],[1,"w-11/12","md:w-1/2","gsap-contenido","mx-auto","p-2","mt-4",3,"ngClass"],[1,"text-3xl","text-center","font-semibold"],[1,"text-sm"],[1,"flex","items-center","mt-6"],["class","font-semibold",4,"ngIf"],["class","text-primaryColor ml-2 animate-spin",4,"ngIf"],[3,"ngClass"],["placeholder","DNI o Nombre de usuario","type","text",1,"input-generico","w-full","mt-2",3,"ngClass","ngModel","ngModelChange"],["buscadorUsuarios",""],["class","w-96 text-sm border mt-1 border-gray-400 bg-white z-10 fixed",4,"ngIf"],["class","mt-2 border border-gray-400",4,"ngIf"],["class","mt-4",4,"ngIf"],[1,"mt-4"],[1,"font-semibold"],[1,"text-red-700"],["type","text","placeholder","Ej. 2664869642",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],[1,"text-red-500"],[1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],["placeholder","Debe detallar su problema aqu\xED",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],[1,"boton-crear","mt-2","w-full",3,"click"],[1,"text-primaryColor","ml-2","animate-spin"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","d","M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"],[1,"w-96","text-sm","border","mt-1","border-gray-400","bg-white","z-10","fixed"],[1,"flex","items-center","justify-between","p-2","border-b","border-gray-400"],[3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18 18 6M6 6l12 12"],[1,"max-h-64","overflow-y-auto"],["class","p-2 border-b-2 flex items-center cursor-pointer hover:bg-slate-100",3,"click",4,"ngFor","ngForOf"],[1,"p-2","border-b-2","flex","items-center","cursor-pointer","hover:bg-slate-100",3,"click"],["src","assets/svg/usuario.svg","alt","Usuario",1,"w-10"],[1,"ml-3"],[1,"text-xs","text-gray-700"],[1,"mt-2","border","border-gray-400"],[1,"flex","items-center","border-l-8","border-emerald-600","justify-between","py-4","px-2"],[1,"flex","items-center"],["src","assets/svg/usuario.svg","alt","Usuario",1,"w-12"],[1,"text-xs","text-gray-600"],["title","Eliminar usuario",1,"border","border-red-500","bg-red-100","p-2","rounded",3,"click"],[1,"input-generico","w-full","mt-2",3,"ngModel","disabled","ngModelChange"],[3,"value"]],template:function(s,t){s&1&&(i(0,"div",0)(1,"h1",1),a(2," Gracias por enviar su solicitud "),e(),i(3,"h2",2),a(4," Pronto nos comunicaremos con usted "),e(),f(5,"img",3),i(6,"div",4)(7,"button",5),m("click",function(){return t.regresarFormulario()}),a(8," Continuar "),e()()(),i(9,"div",6)(10,"h1",7),a(11," Solicitud de asistencia "),e(),i(12,"div",8)(13,"div")(14,"div",9),h(15,se,4,0,"p",10)(16,le,3,0,"span",11),e(),i(17,"div",12)(18,"input",13,14),m("ngModelChange",function(p){return t.filtroUsuarios.parametro=p}),e()(),h(20,de,9,1,"div",15)(21,ue,12,3,"div",16),e(),h(22,me,7,3,"div",17),i(23,"div",18)(24,"p",19)(25,"span",20),a(26," * "),e(),a(27," Telefono de contacto "),e(),i(28,"input",21),m("ngModelChange",function(p){return t.solicitudForm.telefonoContacto=p}),e()(),i(29,"div",18)(30,"p",19)(31,"span",22),a(32," * "),e(),a(33," Tipo de solicitud "),e(),i(34,"select",23),m("ngModelChange",function(p){return t.solicitudForm.tipoOrdenServicioId=p}),i(35,"option",24),a(36," Seleccionar tipo "),e(),h(37,ve,2,2,"option",25),e()(),i(38,"div",18)(39,"p",19)(40,"span",22),a(41," * "),e(),a(42," Detalles del problema "),e(),i(43,"textarea",26),m("ngModelChange",function(p){return t.solicitudForm.observacionSolicitud=p}),e()(),i(44,"button",27),m("click",function(){return t.generarSolicitud()}),a(45," Solicitar asistencia "),e()()()),s&2&&(c("ngClass",E(14,O,!t.solicitudEnviada)),l(9),c("ngClass",E(16,O,t.solicitudEnviada)),l(6),c("ngIf",t.authService.usuario.role!=="USER_ROLE"),l(),c("ngIf",t.buscandoUsuarios),l(),c("ngClass",E(18,O,t.usuarioSeleccionado||t.authService.usuario.role==="USER_ROLE")),l(),c("ngClass",E(20,Se,t.buscandoUsuarios))("ngModel",t.filtroUsuarios.parametro),l(2),c("ngIf",t.usuarios.length>0&&t.filtroUsuarios.parametro!==""),l(),c("ngIf",t.usuarioSeleccionado),l(),c("ngIf",t.usuarioSeleccionado||t.authService.usuario.role==="USER_ROLE"),l(6),c("ngModel",t.solicitudForm.telefonoContacto),l(6),c("ngModel",t.solicitudForm.tipoOrdenServicioId),l(3),c("ngForOf",t.tiposOrdenServicio),l(6),c("ngModel",t.solicitudForm.observacionSolicitud))},dependencies:[H,A,L,G,K,P,J,$,B,q,z,ee],encapsulation:2});let r=d;return r})();export{Ne as default};
